<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="givook.mapper.request">

	<select id="selectByAll" resultType="com.twoyears.model.dto.RequestDTO">
		select * from request_notice

	</select>

	<select id="selectCount" resultType="int">
		select count(*) from request_notice
	</select>

	<select id="selectByRownum" resultType="com.twoyears.model.dto.RequestDTO"
		parameterType="map">
		select * from
		(select rownum as rn, t1.* from
		(select n.*, u.userpwd,u.username,u.usernick, u.userphone,u.useremail,u.userpoint
		from request_notice n, users u
		where u.userid=n.userid	order by rqdate) t1
		) 
		where rn between ${low} and	${high}

		<!-- select * from (select ROWNUM rnum, a.* From (select * from notice) 
			a where ROWNUM &lt;=#{hi}) where rnum >= #{low} -->
	</select>

	<select id="selectByTitle" resultType="com.twoyears.model.dto.RequestDTO"
		parameterType="map">
		select * 
		from (select rownum as rn, t1.* from
		(select n.*, u.userpwd,u.username,u.usernick, u.userphone,u.useremail,u.userpoint
		from request_notice n, users u 
		where u.userid=n.userid and rqtitle like '%'||#{title}||'%' order by rqdate) t1
		)
		where rn between ${low} and ${high}
	</select>
	<select id="selectByContent" resultType="com.twoyears.model.dto.RequestDTO"
		parameterType="map">
		select * from
		(select rownum as rn, t1.* from
		(select n.*, u.userpwd,u.username,u.usernick,u.userphone,u.useremail,u.userpoint
		from request_notice n, users u 
		where u.userid=n.userid and rqcontent like '%'||#{content}||'%' order by rqdate) t1
		)
		where rn between ${low} and ${high}
	</select>
	<select id="selectByUser" resultType="com.twoyears.model.dto.RequestDTO"
		parameterType="map">
		select * from
		(select rownum as rn, t1.* from
		(select	n.*,u.userpwd,u.username,u.usernick,u.userphone,u.useremail,u.userpoint
		from request_notice n, users u 
		where u.userid=n.userid and userNick like '%'||#{user}||'%' order by rqdate) t1
		)
		where rn between ${low} and ${high}
	</select>

	<select id="selectByTitleCount" resultType="int" parameterType="map">
		select count(*) from request_notice n where rqtitle LIKE
		'%'||#{title}||'%'
	</select>

	<select id="selectByContentCount" resultType="int"
		parameterType="map">
		select count(*) from request_notice n where rqcontent
		LIKE '%'||#{content}||'%'
	</select>
	<select id="selectByUserCount" resultType="int" parameterType="map">
		select count(*) 
		from request_notice n, users u 
		where n.userid=u.userid and userNick LIKE '%'||#{user}||'%'
	</select>
	
	<select id="selectRequest" parameterType="int" resultType="com.twoyears.model.dto.RequestDTO">
	select r.rqNo, r.userId, r.rqTitle, r.rqContent, to_char(r.rqDate, 'yyyy/mm/dd mm:mi:ss') "rqDate", r.rqCount,
	u.userNick from REQUEST_NOTICE r, users u where u.userId = r.userId and r.rqNo=#{rqNo}
	
	</select>
	
	<update id="updateRequestCount" parameterType="Map">
	update request_notice set rqCount=#{rqCount} where rqNo=#{rqNo}
	</update>
	
	
	<insert id="insertRequestReply" parameterType="Map">
	insert into request_reply(rqrp_no, rqNo, userId, rqrp_content, rqrp_date) values(
	sq_rqrp_no.nextval,
	#{rqNo:INTEGER},
	#{userId:VARCHAR},
	#{rqrp_content:VARCHAR},
	sysdate
	)
	</insert>
	
	<delete id="deleteRqrp" parameterType="Map">
	delete from request_reply where userId=#{userId} and rqNo=#{rqNo} and rqrp_no=#{rqrp_no}
	</delete>
	
	<select id="selectByRqrp" resultType="rqrpuserdto" parameterType="int">
	select re.rqrp_no, re.rqNo, re.userId, re.rqrp_content, to_char(re.rqrp_date, 'yyyy/mm/dd mm:mi:ss') "rqrp_date", u.userNick
	from request_reply re, users u where re.userId = u.userId and re.rqNo=#{rqNo}
	</select>

<select id="userSelectByMyWirte" resultType="noticejoinbook" parameterType="String">
select n.noticeTitle, n.noticeNo, b.bookGenre,
n.noticeMethod, n.noticeDate, n.noticeCount, n.noticeLocation from notice n, books b where n.userId=#{userId} and n.noticeNo=b.noticeNo
</select>

<select id="userSelectByMyRequestWirte" resultType="requestnoticedto" parameterType="String">
select * from request_notice  where userId=#{userId}
</select>

<insert id="insertRequestNotice" parameterType="requestnoticedto">

insert into request_notice(rqNo, userId, rqTitle, rqContent, rqDate, rqCount) values(
sq_request.nextval,
#{userId:VARCHAR},
#{rqTitle:VARCHAR},
#{rqContent:VARCHAR},
sysdate,
0
)
</insert>

<delete id="deleteRequest" parameterType="int">
delete from request_notice where rqNo=#{rqNo}
</delete>
</mapper>