package com.twoyears.controller;

import java.util.List;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import com.twoyears.model.dto.NoticeDTO;
import com.twoyears.model.dto.RequestDTO;
import com.twoyears.model.dto.RequestNoticeDTO;
import com.twoyears.model.dto.UsersDTO;
import com.twoyears.modelDAO.UserServiceInterface;

@Controller
public class MypageController {
	  
		@Autowired
		private UserServiceInterface userservice;
	
	
		   @RequestMapping(value="/mypage.do", method=RequestMethod.GET)
		   public String MyPage(HttpSession session){
				 UsersDTO user = (UsersDTO) session.getAttribute("userDTO");
				 
					if(user==null){
						System.out.println("로그인해야함");
						return "login";
					}
					else{
						return "mypage";
					}
		      
		      
		   }
		   
		
		   @RequestMapping(value="/modifyinfo.do", method=RequestMethod.GET)
		   public String GetModifyPage(){
		      return "modifyinfo";
		   }


		   @RequestMapping(value="/modifyinfo.do", method=RequestMethod.POST)
		   public String PostModifyPage(UsersDTO user){
		      String userId = user.getUserId();
		      String userNick = user.getUserNick();
		      String userEmail = user.getUserEmail();
		      
		      String userPwd = user.getUserPwd();
		      String userName = user.getUserName();
		      String userPhone = user.getUserPhone();
		      
		      System.out.println(user);
		      
		      
		      UsersDTO usermember = userservice.userSelectByEmail(userEmail);
		      UsersDTO usermember1= userservice.selectByuserNick(userNick);
		      
		      if(usermember!=null || usermember1!=null){
		         return "mypage";
		      }else{
		         
		    	  userservice.userUpdate(userId, userPwd, userName, userNick, userPhone, userEmail);

		         System.out.println("정보 수정성공");
		         return "redirect:/mypage.do";
		      }
		   }
		   
		   
		   @RequestMapping(value="/out.do", method=RequestMethod.GET)
		   public String outPage(){
		      return "memberout";
		   }
		   
		   @RequestMapping(value="/bye.do", method=RequestMethod.GET)
		   public String byePage(HttpSession session){
		      UsersDTO user= (UsersDTO)session.getAttribute("userDTO");
		      String userId =user.getUserId();
		      int ret = userservice.userDelete(userId);
		      System.out.println("삭제 성공");

		      return "redirect:/login.do";
		   }
		   
	
		   
		   @RequestMapping(value="/mycontent.do", method=RequestMethod.GET)
		   public ModelAndView myContent(HttpSession session){
		      ModelAndView mv = new ModelAndView();
		      
		      UsersDTO user= (UsersDTO)session.getAttribute("userDTO");
		      String userId =user.getUserId();
		      System.out.println(userId);
		      List<NoticeDTO> noticelist = userservice.userSelectByMyWirte(userId);
		      List<RequestNoticeDTO> requestlist = userservice.userSelectByMyRequestWirte(userId);
		      
		      System.out.println(requestlist);
		      System.out.println(noticelist);
		      
		      
		      mv.addObject("noticelist", noticelist);
		      mv.addObject("requestlist", requestlist);
		      mv.setViewName("mycontent");
		      
		      return mv;
		   }
		   
		   
		   

		}

	

